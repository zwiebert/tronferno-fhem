=begin html

<a name="TronfernoMCU"></a>
<h3>TronfernoMCU</h3>


<p><i>TronfernoMCU</i> is a physical Device for the purpose of 1) controlling Fernotron devices or 2) utilizing Fernotron controllers into FHEM.
<ul>
 <li>Provides the IODev requiered by Tronferno logical devices</li>
 <li>Requiered MCU/RF-hardware: <a href="https://github.com/zwiebert/tronferno-mcu">tronferno-mcu</a></li>
 <li>Can flash the MCU (ESP32 or ESP8266) using the respective SET command. (if conected to FHEM by USB)</i>
 <li>Can configure the MCU using SET commands</li>
 <li>Can connect to MCU by 1) USB or 2) WLAN.</li>
</ul> 

<p>
<a name="TronfernoMCUset"></a>
<h4>SET</h4>
<ul>

  <a name="mcu-config.baud"></a>
  <li>mcu-config.baud<br>
    Baud rate of MCU's serial interface</li>

  <a name="mcu-config.cu"></a>
  <li>mcu-config.cu<br>
   Central-Unit ID used by the MCU (six digit hex number)</li>


  <a name="mcu-config.latitude"></a>
  <li>mcu-config.latitude<br>
   geographical coordinates are used to calculate civil dusk for astro-timer (decimal degree, e.g. 52.5)</li>

  <a name="mcu-config.longitude"></a>
  <li>mcu-config.longitude<br>
   geographical coordinates are used to calculate civil dusk for astro-timer (decimal degree, e.g. 13,4)</li>

  <a name="mcu-config.restart"></a>
  <li>mcu-config.restart<br>
    Retart the MCU.</li>

  <a name="mcu-config.rtc"></a>
  <li>mcu-config.rtc<br>
    Set MCU's internal real time clock by ISO date/time string (e.g. 1999-12-31T23:59:00). If possible, the MCU will use NTP instead.</li>

  <a name="mcu-config.rtc"></a>
  <li>mcu-config.rtc<br>
    Set MCU's internal real time clock by ISO date/time string (e.g. 1999-12-31T23:59:00). If possible, the MCU will use NTP instead.</li>

  <a name="mcu-config.tz"></a>
  <li>mcu-config.tz<br>
    Time-zone in POSIX (TZ) format</li>

  <a name="mcu-config.rtc"></a>
  <li>mcu-config.rtc<br>
    </li>

  <a name="mcu-config.verbose"></a>
  <li>mcu-config.verbose<br>
    Verbosity level of MCU's diagnose output (0 .. 5)</li>

  <a name="mcu-config.wlan-password"></a>
  <li>mcu-config.wlan-passord<br>
    Password used by MCU to connect to WLAN/WiFi<br>
    Note: MCU will be restarted after setting this option </li>

  <a name="mcu-config.wlan-ssid"></a>
  <li>mcu-config.wlan-ssid<br>
    WLAN/WiFi SSID to connect to<br>
    Note: MCU will be restarted after setting this option</li>

  <a name="xxx.mcu-firmware.esp32"></a>
  <li>xxx.mcu-firmware.esp32<br>

   Fetch and write latest MCU firmware from tronferno-mcu-bin github repository.
    <ul>
     <li>upgrade<br>
         Download latest firmware and write it to the MCU in one shot.<br>
         Required Tools: python, pyserial; <code>apt install python  python-serial</code><br>
         Expected MCU: Plain ESP32 with 4MB flash. Connected to USB (not WLAN)<br>
         Status is shown in reading fw_get and fw_write (run,done,error,timeout).</li>
     <li>download<br>
         Download firmware and flash-tool to /tmp/TronfernoMCU/ directory.<br>
         Status is shown in reading fw_get (run,done,error,timeout).</li>
     <li>write-flash<br>
         Writes downloaded firmware to serial port used in definition of this device.<br>
         Required Tools: python, pyserial; <code>apt install python  python-serial</code><br>
         Expected MCU: Plain ESP32 with 4MB flash. Edit the flash_esp32.sh command for different hardware.<br>
         Status is shown in reading fw_write_flash (run,done,error,timeout). Shell output may be displayed at error.</li>
     <li>xxx.erase-flash<br>
          Optional Step before write-flash: Use downloaded tool to delete the MCU's flash memory content. All saved data in MCU will be lost.<br>
         Required Tools: python, pyserial; <code>apt install python  python-serial</code><br>
         Status is shown in reading fw_erase_flash (run,done,error,timeout). Shell output may be displayed at error.</li>
    </ul>
  </li>

  <a name="xxx.mcu-firmware.esp8266"></a>
  <li>xxx.mcu-firmware.esp8266<br>
   Fetch and write latest MCU firmware from tronferno-mcu-bin github repository.
    <ul>
     <li>upgrade<br>
         Download latest firmware and write it to the MCU in one shot.<br>
         Required Tools: python, pyserial; <code>apt install python  python-serial</code><br>
         Expected MCU: Plain ESP8266 with 4MB flash. Connected to USB (not WLAN)<br>
         Status is shown in reading fw_get and fw_write (run,done,error,timeout).</li>
     <li>download<br>
         Download firware and flash-tool to /tmp/TronfernoMCU/ directory.<br>
         Status is shown in reading fw_get (run,done,error,timeout).</li>
     <li>write-flash<br>
         Writes downloaded firmware to serial port used in definition of this device.<br>
         Required Tools: python, pyserial; <code>apt install python  python-serial</code><br>
         Expected MCU: Plain ESP8266 with 4MB flash. Edit the flash_esp32.sh command for different hardware.<br>
         Status is shown in reading fw_write_flash (run,done,error,timeout). Shell output may be displayed at error.</li>
     <li>xxx.erase-flash<br>
          Optional Step before write-flash: Use downloaded tool to delete the MCU's flash memory content. All saved data in MCU will be lost.<br>
         Required Tools: python, pyserial; <code>apt install python  python-serial</code><br>
         Status is shown in reading fw_erase_flash (run,done,error,timeout). Shell output may be displayed at error.</li>
    </ul>
  </li>


</ul>

<br>     Examples:
<br>
<br> 1) MCU module is connected via TCP/IP
<br>
<br>    define tfmcu TronfernoMCU  192.168.1.123
<br>    define shutter_11 Tronferno g=1 m=1
<br>    define shutter_12 Tronferno g=1 m=2
<br>     ..
<br>    define shutter_77 Tronferno g=7 m=7
<br>
<br> 2) MCU module is connected via USB port /dev/ttyUSB1
<br>
<br>    define tfmcu TronfernoMCU /dev/ttyUSB1
<br>    define shutter_11 Tronferno g=1 m=1
<br>    define shutter_12 Tronferno g=1 m=2
<br>     ..
<br>    define shutter_77 Tronferno g=7 m=7
<br>
<br>  ### Make sure the I/O device tfmcu is defined before any shutter_xx device ###
<br>  ### Otherwise the shutter_xx devices can't find their I/O device (because its not defined yet) ###

<p>

=end html
